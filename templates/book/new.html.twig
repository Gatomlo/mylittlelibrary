{% extends 'base.html.twig' %}

{% block title %}Nouveau livre{% endblock %}

{% block body %}
    <h1>Créer un nouveau livre</h1>
    {{ form_start(form) }}
        <div class="input-group mb-3">
            {{form_row(form.ISBN)}}
            <button class="btn btn-outline-secondary" type="button" id="submit"><i class="fas fa-magic"></i></button>
        </div>
        {{ form_widget(form) }}
        <button class="btn btn-primary">{{ button_label|default('Save') }}</button>
    {{ form_end(form) }}

    <a class="btn btn-primary" href="{{ path('book_index') }}">Retour</a>
{% endblock %}

{% block javascript %}
  <script>
    //neutralisation du cache Ajax pour pouvoir réeffectuer la recherche
     $.ajaxSetup({ cache: false });
     $("#submit").click(function(evt) {
       evt.preventDefault();
       // $("#book").html("");
       var tags = $("#book_ISBN").val();
       var key = 'AIzaSyDo7w86Zn0wYlnkc6jUZx8dnrdq8RmtMc4';
       var url = 'https://www.googleapis.com/books/v1/volumes?q='+tags+'&key='+key;
       $.getJSON( url, function( json ) {})
         .done(function(data) {
           console.log(data)
           book=data['items'][0];
           console.log(book)
         $("#book_title").val(book["volumeInfo"]["title"] || "")
         var authors = book["volumeInfo"]["authors"];
         authors.toString();
         $("#book_author").val(authors)
         $("#book_language").val(book["volumeInfo"]["language"] || "")
         $("#book_year").val(book["volumeInfo"]["publishedDate"] || "")
         $("#book_editor").val(book["volumeInfo"]["publisher"] || "")
         $("#book_paging").val(book["volumeInfo"]["pageCount"] || "")
         $("#book_abstract").val(book["volumeInfo"]["description"] || "")
         $("#book_image").val(book["volumeInfo"]["imageLinks"]["smallThumbnail"] || "")
         })
     });
  </script>
{% endblock %}
